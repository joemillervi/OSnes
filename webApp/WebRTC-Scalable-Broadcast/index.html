<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-peer/6.0.2/simplepeer.min.js"></script>
    <label>Your ID:</label><br/>
    <textarea id="yourId"></textarea><br/>
    <label>Other ID:</label><br/>
    <textarea id="otherId"></textarea>
    <button id="connect">connect</button><br/>

    <label>Enter Message:</label><br/>
    <textarea id="yourMessage"></textarea>
    <button id="send">send</button>
    <pre id="messages"></pre>
  </body>
</html>
<script>

var socket = io.connect();
var isTheStreamer = false;
var peers = {
  id: {
    peer: null,
    connected: false
  }
};

socket.on('become-first-streamer') {
  isTheStreamer = true;
}

// new peer has requested connection
socket.on('new-peer', function(id) {
  // create new peer
  peers[id] = {};
  peers[id].peer = new SimplePeer({
    initiator: true;
    trickle: false;
  })
  // listener to send SDP back
  peers[id].peer.on('signal', function(SDP) {
    // if not already connected
    if (!peers[id].connected) {
      socket.emit('connect-to-peer', {id: id, SDP: SDP})
      peers[id].connected = true;
    }
  })
})

// complete peer connection
socket.on('got-requested-SDP', function(data) {
  peers[data.id].signal(data.SDP)
})




var peer = new SimplePeer({
  initiator: location.hash === '#init',
  trickle: false
  // stream: stream
})

peer.on('signal', function (data) {
  console.log('got signaled')
  document.getElementById('yourId').value = JSON.stringify(data)
})

document.getElementById('connect').addEventListener('click', function () {
  var otherId = JSON.parse(document.getElementById('otherId').value)
  peer.signal(otherId)
})

document.getElementById('send').addEventListener('click', function () {
  var yourMessage = document.getElementById('yourMessage').value
  peer.send(yourMessage)
})

peer.on('data', function (data) {
  document.getElementById('messages').textContent += data + '\n'
})
//
// peer.on('stream', function (stream) {
//   var video = document.createElement('video')
//   document.body.appendChild(video)
//
//   video.src = window.URL.createObjectURL(stream)
//   video.play()
// })







</script>
